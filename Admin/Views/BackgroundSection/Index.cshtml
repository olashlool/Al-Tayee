@using Microsoft.AspNetCore.Mvc.Localization;
@inject IViewLocalizer Localizer
@model List<Admin.Models.BackgroundSection>

<div class="ec-content-wrapper" id="AddProduct">
    <div class="content">
        <div class="row">
            <div class="col-12">
                <div class="card card-default">
                    <div class="card-header card-header-border-bottom">
                        <h2>@Localizer["Edit"]</h2>
                    </div>
                    <div class="card-body">
                        <div class="row ec-vendor-uploads">
                            <span class="spnreq" id="Imagesreq" style="color : red ; display:none"> @Localizer["UplaodAtLeastTwoImages"]</span>
                            <div class="col-lg-4">
                                <div class="ec-vendor-img-upload">
                                    <div class="ec-vendor-main-img">
                                        <div class="avatar-upload thumb-upload">
                                            <div class="avatar-edit">
                                                <input type="file" class="ec-image-upload rec imageInput" accept=".png, .jpg, .jpeg" id="editIcon">
                                                <label for="imageUpload"><img src="/admin/assets/img/icons/edit.svg" class="svg_img header_svg" alt="edit"></label>
                                            </div>
@*                                             <div class="deleted-image-upload avatar-edit" style="left: 25px; width:40px;">
                                                <input type="button" class="ec-image-upload">
                                                <label for="imageUpload"><i class="mdi mdi mdi-delete-outline header_svg newimageUpload" style="font-size:25px;"></i></label>
                                            </div> *@
                                            <div class="avatar-preview ec-preview thumb-preview">
                                                <div class="imagePreview ec-div-preview imageContainer">
                                                    <img class="ec-image-preview" src="/admin/assets/img/products/vender-upload-preview.png" alt="edit">
                                                </div>
                                            </div>
                                        </div>
@*                                         <div class="thumb-upload-set colo-md-12">
                                            <div class="thumb-upload">
                                                <div class="thumb-edit">
                                                    <input type="file" class="imageUpload ec-image-upload rec imageInput" accept=".png, .jpg, .jpeg">
                                                    <label for="imageUpload"><img src="/admin/assets/img/icons/edit.svg" class="svg_img header_svg" alt="edit"></label>
                                                </div>
                                                <div class="deleted-image-upload" style="left: 5px;">
                                                    <input type="button" class="ec-image-upload">
                                                    <label for="imageUpload"><i class="mdi mdi mdi-delete-outline header_svg newimageUpload" style="font-size:20px;"></i></label>
                                                </div>
                                                <div class="thumb-preview ec-preview">
                                                    <div class="image-thumb-preview imageContainer">
                                                        <img class="image-thumb-preview ec-image-preview" src="/admin/assets/img/products/vender-upload-thumb-preview.png" alt="edit">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="button" id="addImage"> <i class="mdi mdi-image-plus"></i> </button>
 *@                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-8">
                                <div class="ec-vendor-upload-detail">
                                    <form class="row g-3">
                                        <div class="col-md-6">
                                            <label for="inputEmail4" class="form-label">@Localizer["TitleEn"]</label>
                                            <span class="spnreq" id="TitleEntxtreq" style="color : red ; display:none">@Localizer["TitleIsRequired"]</span>
                                            <input type="text" class="form-control slug-title req" id="TitleEntxt">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="inputEmail4" class="form-label">@Localizer["TitleAr"]</label>
                                            <span class="spnreq" id="TitleEntxtreqAr" style="color : red ; display:none">@Localizer["TitleIsRequired"]</span>
                                            <input type="text" class="form-control slug-title req" id="TitleArtxt">
                                        </div>
                                        <div class="col-md-12">
                                            <label class="form-label">@Localizer["DescriptionEn"]</label>
                                            <span class="spnreq" id="descEntxtreq" style="color : red ; display:none">@Localizer["DescriptionIsRequired"]</span>
                                            <textarea id="descEntxt" class="form-control req" rows="2"></textarea>
                                        </div>
                                        <div class="col-md-12">
                                            <label class="form-label">@Localizer["DescriptionAr"]</label>
                                            <span class="spnreq" id="descEntxtreqAr" style="color : red ; display:none">@Localizer["DescriptionIsRequired"]</span>
                                            <textarea id="descEntxtAr" class="form-control req" rows="2"></textarea>
                                        </div>
                                        <div class="col-md-12">
                                            <button type="button" id="SaveProductbtn" class="btn btn-primary">@Localizer["Submit"]</button>
                                            <button type="button" id="Cancelbtn" class="btn btn-danger">@Localizer["Cancel"]</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Content -->
</div>

<div class="ec-content-wrapper">
    <div class="content">
        <div class="breadcrumb-wrapper d-flex align-items-center justify-content-between">
            <div>
                <h1>@Localizer["BackgroundSection"]</h1>
                <p class="breadcrumbs">
                    <span><a href="/">@Localizer["Home"]</a></span>
                    <span><i class="mdi mdi-chevron-right"></i></span>@Localizer["BackgroundSection"]
                </p>
            </div>
            <div>
                <a class="btn btn-primary AddProduct" data_id="@Model.FirstOrDefault().Id"> @Localizer["Edit"]</a>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card card-default">
                    <div class="card-header card-header-border-bottom d-flex justify-content-between">
                        <div class="card-bar">
                        </div>
                    </div>
                    <div class="card-body">
                        <div onclick="" class="row" id="ProductCard">
                            @foreach (var item in Model)
                            {
                                <div class="col-12">
                                    <div class="card-wrapper">
                                        <div class="card-container">
                                            <div class="card-top"><img class="card-image" src="@item.ImageUrl" alt=""></div>
                                            <hr>
                                            <div class="card-bottom" data_id="@item.Id">
                                                @{
                                                    string culture = System.Threading.Thread.CurrentThread.CurrentUICulture.Name;
                                                    var title = culture.StartsWith("en") ? item.TitleEn : item.TitleAr;
                                                    var desc = culture.StartsWith("en") ? item.DescriptionEn : item.DescriptionAr;
                                                }
                                                <h2>@title</h2>
                                                <p>@desc</p>
                                            </div>
@*                                             <div class="card-action">
                                                <div class="card-edit EditProduct" data_id="@item.Id"><i class="mdi mdi-circle-edit-outline"></i></div>
                                                <div class="card-preview Details" data_id="@item.Id"><i class="mdi mdi-eye-outline"></i></div>
                                                <div class="card-remove DeleteProduct" data_id="@item.Id"><i class="mdi mdi mdi-delete-outline"></i></div>
                                            </div> *@
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/lib/jquery/dist/jquery.min.map"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>

<script>
    var imagesToUpload = [];
    var imagesToUploadFiles = {};
    var form = new FormData();
    var Image;
    // var oldImage = @Html.Raw(Json.Serialize(Model));
    $(document).ready(function () {
        $(document).on("click", ".AddProduct", function () {
            debugger
            var Id = $(this).attr('data_Id');

            $.ajax({
                url: "/BackgroundSection/GetBackgroundSectionById?id=" + Id,
                type: "GET",
                dataType: "json",
                processData: false,
                contentType: false,
                success: function (result) {
                    $(".ec-image-preview").attr("src", result.imageUrl);
                    $("#TitleEntxt").val(result.titleEn);
                    $("#TitleArtxt").val(result.titleAr);
                    $("#descEntxt").val(result.descriptionEn);
                    $("#descEntxtAr").val(result.descriptionAr);
                    // $("#TitleEntxt").val(result.titleEn);
                },
                error: function (xhr, status, error) {
                    // Handle any errors that occur during the AJAX request
                }
            });
            $("#AddProduct").slideDown(2000);
        });
        $(document).on("click", "#Cancelbtn", function () {
            // imagesToUpload = [];
            $("#AddProduct").slideUp(1000);
        });
        $(document).on('change', '.imageInput', function (e) {
            imagesToUpload = [];

            var file = e.target.files[0];

            // Find the closest imageContainer div relative to the current input
            var imageContainer = $(this).closest('.thumb-upload').find('.imageContainer');

            // Get the current source (src) of the ec-image-preview element
            var currentSrc = imageContainer.find('.ec-image-preview').attr('src');

            // Create an object URL for the image file
            var objectURL = URL.createObjectURL(file);

            // Create an <img> element and set its source to the object URL
            var img = $('<img>').attr('src', objectURL);

            // Empty the selected imageContainer div and append the image
            imageContainer.empty().append(img);

            var updatedSrc = img.attr('src');
            updatedSrc = updatedSrc.substr(updatedSrc.lastIndexOf('/') + 1);

            //imagesToUpload.push(updatedSrc);
            imagesToUpload.push(file, updatedSrc);
            $(this).val(null);
        });
        function AddProduct() {
            debugger
            var TitleEn = $("#TitleEntxt").val();
            var TitleAr = $("#TitleArtxt").val();
            var DescriptionEn = $("#descEntxt").val();
            var DescriptionAr = $("#descEntxtAr").val();

            let valid = true;

            if (TitleEn == "") {
                valid = false;
                $('#TitleEntxtreq').show();
            }
            if (TitleAr == "") {
                valid = false;
                $('#TitleEntxtreqAr').show();
            }
            if (DescriptionEn == "") {
                valid = false;
                $('#descEntxtreq').show();
            }
            if (DescriptionAr == "") {
                valid = false;
                $('#descEntxtreqAr').show();
            }
            if (valid == true) {
                var backgroundSection = {
                    TitleEn: TitleEn,
                    TitleAr: TitleAr,
                    DescriptionAr: DescriptionAr,
                    DescriptionEn: DescriptionEn,
                    Id: $(".card-bottom").attr('data_Id'),
                };

                $.each(imagesToUpload, function (i, item) {
                    if (typeof item === 'string') {
                        form.append("NameOfImages", item);
                    } else if (item instanceof File) {
                        form.append("Images", item);
                    }
                });
                form.append("backgroundSection", JSON.stringify(backgroundSection));

                $.ajax({
                    url: "/BackgroundSection/Edit",
                    type: "POST",
                    data: form,
                    processData: false,
                    contentType: false,
                    success: function (result) {
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        // Handle any errors that occur during the AJAX request
                    }
                });
            }
        }
        $(document).on("click", "#SaveProductbtn", function () {
            AddProduct();
        });
    });

</script>